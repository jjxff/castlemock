# Castle Mock v1.69.1 Community Fork

**Release Date**: January 8, 2025  
**Type**: Patch Release (New Feature)

## üõ°Ô∏è New Feature: Guard Functionality

### Overview
Added **Guard functionality** for REST mock responses - a powerful new feature that allows mock responses to act as **header interceptors** for authentication and security validation.

### Key Features

#### ‚úÖ **Header Interceptor Pattern**
- Guards evaluate **first**, before any Response Strategy
- If header validation **fails** ‚Üí Returns guard response immediately (e.g., 401 Unauthorized)  
- If header validation **passes** ‚Üí Continues to other mock responses
- Perfect for JWT token validation, API key authentication, and header-based security

#### ‚úÖ **Independent Evaluation**
- Guards work **independently** of Response Strategies (JSON Path, Header Query Match, etc.)
- No longer constrained by AND logic of multiple strategies
- Can use guards with any combination of other response strategies

#### ‚úÖ **UI Enhancements**  
- New "Is Guard" checkbox in mock response configuration
- Informative tooltip explaining guard functionality
- Clean integration with existing UI

### Technical Implementation

#### Backend Changes
- **Domain Model**: Added `isGuard` Boolean field to `RestMockResponse`
- **Services**: Updated `CreateRestMockResponseService` and `UpdateRestMockResponseService` for proper persistence
- **Controller Logic**: Modified `AbstractRestServiceController` to evaluate guards independently
- **Architecture**: Guards filter out of normal response selection after evaluation

#### Frontend Changes
- **React Component**: Enhanced `RestMockResponse.js` with guard checkbox and tooltip
- **User Experience**: Clear visual indication of guard functionality

#### Files Modified
```
model/model-mock/model-mock-rest/src/main/java/com/castlemock/model/mock/rest/domain/RestMockResponse.java
service/service-mock/service-mock-rest/src/main/java/com/castlemock/service/mock/rest/project/CreateRestMockResponseService.java
service/service-mock/service-mock-rest/src/main/java/com/castlemock/service/mock/rest/project/UpdateRestMockResponseService.java
web/web-mock/web-mock-rest/src/main/java/com/castlemock/web/mock/rest/controller/mock/AbstractRestServiceController.java
web/web-frontend/src/components/project/rest/mockresponse/RestMockResponse.js
```

### Use Cases

#### üîê **JWT Token Validation**
```
Guard Configuration:
- Header: Authorization  
- Pattern: ^Bearer\s+[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+$
- Response: 401 with {"error": "Invalid JWT token"}
```

#### üîë **API Key Authentication**  
```
Guard Configuration:
- Header: X-API-Key
- Pattern: ^[a-f0-9]{32}$
- Response: 401 with {"error": "Invalid API key"}
```

#### üö´ **Missing Authorization**
```
Guard Configuration:  
- Header: Authorization
- Pattern: .+ (any non-empty value)
- Response: 401 with {"error": "Authorization required"}
```

### Compatibility
- ‚úÖ **100% Backward Compatible**: Existing projects work unchanged
- ‚úÖ **Optional Feature**: Only activates when `isGuard` is checked
- ‚úÖ **No Breaking Changes**: All existing functionality preserved

### Architecture Benefits
- **Clean Separation**: Security (guards) vs Business Logic (responses)
- **Early Evaluation**: Guards process before expensive strategy matching
- **Flexible Design**: Works with any Response Strategy combination
- **Performance**: Guards filter efficiently without strategy overhead

---

## Version Update
- **Version**: Updated from 1.69.0 to 1.69.1  
- **Maven**: All pom.xml files updated
- **Docker**: Updated Dockerfile and docker-compose.yml
- **Documentation**: Updated README.md with Guard functionality

## Breaking Changes
**None** - This is a fully backward-compatible release.

## Migration Guide
**No migration required** - Guards are an optional feature that doesn't affect existing functionality.

---

*This release focuses on enhancing CastleMock's security and authentication capabilities while maintaining full backward compatibility.*