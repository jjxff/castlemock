language: java

jdk:
  - oraclejdk8
  - oraclejdk9
  - openjdk10

after_success:
  - if [ -e ./gradlew ]; then ./gradlew jacocoTestReport;else gradle jacocoTestReport;fi
  - bash <(curl -s https://codecov.io/bash)

deploy:
  provider: s3
  access_key_id: $AWS_ACCESS_KEY
  secret_access_key: $AWS_SECRET_ACCESS_KEY
  bucket: "castlemock"
  local_dir: code/web/war/build/libs
  skip_cleanup: true
  upload-dir: package/war/stable/latest
  on:
    branch: master
    tags: true
    jdk: openjdk10

deploy:
  provider: s3
  access_key_id: $AWS_ACCESS_KEY
  secret_access_key: $AWS_SECRET_ACCESS_KEY
  bucket: "castlemock"
  local_dir: code/web/war/build/libs
  skip_cleanup: true
  upload-dir: package/war/stable/$TRAVIS_TAG
  on:
    branch: master
    tags: true
    jdk: openjdk10

deploy:
  provider: s3
  access_key_id: $AWS_ACCESS_KEY
  secret_access_key: $AWS_SECRET_ACCESS_KEY
  bucket: "castlemock"
  local_dir: code/web/war/build/libs
  skip_cleanup: true
  upload-dir: package/war/daily/latest
  on:
    branch: master
    jdk: openjdk10

deploy:
  provider: bintray
  file: code/web/war/build/libs/castlemock.war
  user: $BINTRAY_USER
  key: $BINTRAY_API_KEY
  skip_cleanup: true
  on:
    branch: master
    jdk: openjdk10